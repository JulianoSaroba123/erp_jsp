<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Ordem de Serviço {{ os.codigo }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
        }
        .container {
            max-width: 100%;
            margin: 0;
            padding: 0;
        }
        .table {
            font-size: 11px;
        }
        .table th,
        .table td {
            vertical-align: middle !important;
            padding: 8px;
        }
        h3, h5 {
            color: #222 !important;
            font-weight: bold;
        }
        h3 {
            font-size: 18px;
            margin-bottom: 15px;
        }
        h5 {
            font-size: 14px;
            margin-bottom: 10px;
            margin-top: 20px;
        }
        .fw-bold {
            font-weight: bold !important;
        }
        .text-end {
            text-align: right !important;
        }
        .text-center {
            text-align: center !important;
        }
        .mb-0 { margin-bottom: 0 !important; }
        .mb-3 { margin-bottom: 1rem !important; }
        .mb-4 { margin-bottom: 1.5rem !important; }
        .mt-5 { margin-top: 3rem !important; }
        .text-muted { color: #6c757d !important; }
        .small { font-size: 0.875em; }
    </style>
</head>
<body>
    <div class="container relatorio-os">
        <div class="row align-items-center mb-3">
            <div class="col-2 text-center">
                <!-- Logo seria inserida aqui se disponível -->
                <div style="width: 90px; height: 90px; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; font-size: 10px;">LOGO JSP</div>
            </div>
            <div class="col-10">
                <h3 class="mb-0">ORDEM DE SERVIÇO Nº {{ os.codigo }}</h3>
                <div class="text-muted small">
                    JSP ELÉTRICA INDUSTRIAL &amp; SOLAR<br>
                    CNPJ: 41.280.764/0001-65<br>
                    Rua Indalécio Costa, 890 - Barra Funda - Tietê/SP - CEP: 18532-122<br>
                    Fone: (15)99670-2036 / (15)99802-5861
                </div>
            </div>
        </div>
        <hr>
        
        <h5 class="mt-3">Dados do Cliente</h5>
        <table class="table table-bordered table-sm mb-4">
            <tbody>
                <tr><th style="width: 150px;">Nome</th><td>{{ os.cliente.nome if os.cliente else 'Cliente não informado' }}</td></tr>
                {% if os.cliente and os.cliente.cpf_cnpj %}
                <tr><th>CPF/CNPJ</th><td>{{ os.cliente.cpf_cnpj }}</td></tr>
                {% endif %}
                {% if os.cliente and os.cliente.telefone %}
                <tr><th>Telefone</th><td>{{ os.cliente.telefone }}</td></tr>
                {% endif %}
                {% if os.cliente and os.cliente.email %}
                <tr><th>E-mail</th><td>{{ os.cliente.email }}</td></tr>
                {% endif %}
                {% if os.cliente and os.cliente.endereco %}
                <tr><th>Endereço</th><td>{{ os.cliente.endereco }}</td></tr>
                {% endif %}
                {% if os.solicitante %}
                <tr><th>Solicitante</th><td>{{ os.solicitante }}</td></tr>
                {% endif %}
                {% if os.contato %}
                <tr><th>Contato</th><td>{{ os.contato }}</td></tr>
                {% endif %}
            </tbody>
        </table>
        
        {% if os.equipamento_nome or os.equipamento_marca or os.equipamento_modelo or os.equipamento_numero_serie or os.equipamento_acessorios %}
        <h5>Equipamento</h5>
        <table class="table table-bordered table-sm mb-4">
            <tbody>
                {% if os.equipamento_nome %}<tr><th style="width: 150px;">Nome</th><td>{{ os.equipamento_nome }}</td></tr>{% endif %}
                {% if os.equipamento_marca %}<tr><th>Marca</th><td>{{ os.equipamento_marca }}</td></tr>{% endif %}
                {% if os.equipamento_modelo %}<tr><th>Modelo</th><td>{{ os.equipamento_modelo }}</td></tr>{% endif %}
                {% if os.equipamento_numero_serie %}<tr><th>Nº Série</th><td>{{ os.equipamento_numero_serie }}</td></tr>{% endif %}
                {% if os.equipamento_acessorios %}<tr><th>Acessórios</th><td>{{ os.equipamento_acessorios }}</td></tr>{% endif %}
            </tbody>
        </table>
        {% endif %}
        
        {% if servicos_dados and servicos_dados|length > 0 %}
        <h5>Serviços</h5>
        <table class="table table-bordered table-sm mb-4">
            <thead class="table-light">
                <tr>
                    <th>Serviço</th>
                    <th style="width: 100px;">Total Horas</th>
                    <th style="width: 120px;">Total</th>
                </tr>
            </thead>
            <tbody>
                {% set total_horas = 0 %}
                {% set total_valor_servicos = 0 %}
                {% for s in servicos_dados %}
                <tr>
                    <td>{{ s.nome or s.descricao or 'Serviço' }}</td>
                    <td class="text-end">{{ '%.2f'|format(s.quantidade|float) }}h</td>
                    <td class="text-end">R$ {{ '%.2f'|format(s.valor_total|float) }}</td>
                </tr>
                {% set total_horas = total_horas + (s.quantidade|float) %}
                {% set total_valor_servicos = total_valor_servicos + (s.valor_total|float) %}
                {% endfor %}
                <tr class="fw-bold">
                    <td class="text-end">Total de Horas</td>
                    <td class="text-end">{{ '%.2f'|format(total_horas) }}h</td>
                    <td class="text-end">R$ {{ '%.2f'|format(total_valor_servicos) }}</td>
                </tr>
            </tbody>
        </table>
        {% endif %}
        
        {% if produtos_dados and produtos_dados|length > 0 %}
        <h5>Produtos</h5>
        <table class="table table-bordered table-sm mb-4">
            <thead class="table-light">
                <tr>
                    <th>Produto</th>
                    <th style="width: 80px;">Quantidade</th>
                    <th style="width: 120px;">Valor Unitário</th>
                    <th style="width: 120px;">Valor Total</th>
                </tr>
            </thead>
            <tbody>
                {% for p in produtos_dados %}
                <tr>
                    <td>{{ p.nome or p.descricao or 'Produto' }}</td>
                    <td class="text-end">{{ p.quantidade }}</td>
                    <td class="text-end">R$ {{ '%.2f'|format(p.valor_unitario|float) }}</td>
                    <td class="text-end">R$ {{ '%.2f'|format(p.valor_total|float) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
        
        <!-- Informações de Pagamento -->
        <h5>Informações de Pagamento</h5>
        <div class="row mb-3">
            <div class="col-6">
                <p><strong>Condições:</strong> {{ os.condicoes_pagamento or 'À vista' }}</p>
            </div>
            <div class="col-6">
                <p><strong>Forma de Pagamento:</strong> {{ os.forma_pagamento or 'A definir' }}</p>
            </div>
        </div>
        
        {% if parcelas and parcelas|length > 0 %}
        <h5>Parcelas</h5>
        <table class="table table-bordered table-sm mb-4">
            <thead class="table-light">
                <tr>
                    <th style="width: 80px;">Parcela</th>
                    <th style="width: 120px;">Valor</th>
                    <th style="width: 120px;">Vencimento</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for p in parcelas %}
                <tr>
                    <td class="text-center">{{ p.numero }}</td>
                    <td class="text-end">R$ {{ '%.2f'|format(p.valor|float) }}</td>
                    <td class="text-center">{{ p.data_vencimento }}</td>
                    <td>{{ p.status }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
        
        <div class="row mb-4">
            <div class="col-6">
                <h5>Resumo Financeiro</h5>
                <table class="table table-bordered table-sm">
                    <tbody>
                        <tr><th style="width: 150px;">Total Serviços</th><td>R$ {{ '%.2f'|format(total_servicos|default(0, true)|float) }}</td></tr>
                        <tr><th>Total Produtos</th><td>R$ {{ '%.2f'|format(total_produtos|default(0, true)|float) }}</td></tr>
                        <tr class="fw-bold"><th>Total Geral</th><td>R$ {{ '%.2f'|format(valor_total|default(0, true)|float) }}</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="col-6">
                <h5>Dados para Transferência</h5>
                <table class="table table-bordered table-sm">
                    <tbody>
                        <tr><th style="width: 80px;">Banco</th><td>Bradesco</td></tr>
                        <tr><th>Agência</th><td>0367-6</td></tr>
                        <tr><th>Conta</th><td>0082598-4</td></tr>
                        <tr><th>CNPJ</th><td>29.256.846/0001-59</td></tr>
                        <tr><th>PIX</th><td>29.256.846/0001-59</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="row mb-4">
            <div class="col-6">
                <h5>Técnico Responsável</h5>
                <div>{{ os.tecnico_responsavel or 'Juliano Saroba Pereira' }}</div>
            </div>
            <div class="col-6">
                <h5>Problema Descrito</h5>
                <div>{{ os.problema_descrito or 'N/A' }}</div>
            </div>
        </div>
        
        {% if os.descricao_servico_realizado %}
        <div class="mb-4">
            <h5>Descrição do Serviço Realizado</h5>
            <div>{{ os.descricao_servico_realizado }}</div>
        </div>
        {% endif %}
        
        <div class="row mt-5">
            <div class="col-6 text-center">
                <div style="border-top:1px solid #333; margin-top:40px; padding-top:5px;">Assinatura do Cliente</div>
            </div>
            <div class="col-6 text-center">
                <div style="border-top:1px solid #333; margin-top:40px; padding-top:5px;">Assinatura do Responsável</div>
            </div>
        </div>
    </div>
</body>
</html>
