{% extends 'base.html' %}
{% block titulo %}Clientes — JSP ERP{% endblock %}
{% block content %}

<style>
  .table-jsp {
    background-color: #1a1a1a; /* Fundo escuro */
    color: #ffffff; /* Texto claro */
  }
  .table-jsp th {
    background-color: #333333; /* Fundo escuro para cabeçalhos */
    color: #ffffff; /* Texto claro para cabeçalhos */
  }
  .table-jsp td {
    color: var(--jsp-cyan); /* Destaque para todos os campos */
    font-weight: bold;
  }
</style>

<div class="page-title">
  <div class="ico"><i class="fas fa-users"></i></div>
  <h3 style="margin:0;">Clientes</h3>
</div>

<div class="card card-jsp mb-3">
  <div class="card-header d-flex flex-wrap gap-2 align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-2">
      <i class="fas fa-database"></i>
      <strong>Base de Clientes</strong>
    </div>
    <div class="d-flex flex-wrap gap-2">
      <form class="d-flex flex-grow-1" method="GET" action="{{ url_for('cliente.listar_clientes') }}">
        <input class="form-control form-control-sm" type="search" name="q" placeholder="Buscar por nome, documento ou e-mail"
               value="{{ request.args.get('q','') }}" style="min-width:200px">
        <button class="btn btn-brand btn-sm ms-2" type="submit"><i class="fas fa-search me-1"></i> <span class="d-none d-sm-inline">Buscar</span></button>
      </form>
      <a class="btn btn-brand btn-sm" href="{{ url_for('cliente.novo_cliente') }}">
        <i class="fas fa-user-plus me-1"></i> <span class="d-none d-sm-inline">Novo Cliente</span>
      </a>
    </div>
  </div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-jsp table-striped align-middle mb-0">
        <thead>
          <tr>
            <th style="width:110px;">Código</th>
            <th>Nome/Razão</th>
            <th style="width:150px;" class="d-none d-md-table-cell">CPF/CNPJ</th>
            <th style="width:140px;" class="d-none d-lg-table-cell">Telefone</th>
            <th style="width:220px;" class="d-none d-xl-table-cell">E-mail</th>
            <th style="width:160px;" class="d-none d-lg-table-cell">Cidade/UF</th>
            <th style="width:110px;" class="d-none d-md-table-cell">Status</th>
            <th style="width:140px;" class="text-end">Ações</th>
          </tr>
        </thead>
        <tbody>
        {% if clientes and clientes|length > 0 %}
          {% for c in clientes %}
          <tr>
            <td><code class="d-none d-sm-inline">{{ c.codigo or ('CLI%05d' % c.id) }}</code></td>
            <td>
              <strong>{{ c.nome }}</strong>
              {% if c.apelido %}<div class="text-muted small">{{ c.apelido }}</div>{% endif %}
              <div class="d-md-none small text-muted">
                {{ c.cpf_cnpj or '-' }} | {{ c.telefone or '-' }}
              </div>
            </td>
            <td class="d-none d-md-table-cell">{{ c.cpf_cnpj or '-' }}</td>
            <td class="d-none d-lg-table-cell">{{ c.telefone or '-' }}</td>
            <td class="d-none d-xl-table-cell"><a href="mailto:{{ c.email }}">{{ c.email or '-' }}</a></td>
            <td class="d-none d-lg-table-cell">
              {% set cid = c.cidade or '-' %}
              {% set uf  = c.uf or '' %}
              <span>{{ cid }}{% if uf %}/{{ uf }}{% endif %}</span>
            </td>
            <td class="d-none d-md-table-cell">
              {% if c.ativo %}
                <span class="chip chip-done">Ativo</span>
              {% else %}
                <span class="chip" style="background:#ffb3b3;color:#4a0c0c;">Inativo</span>
              {% endif %}
            </td>
            <td class="text-end">
              <div class="btn-group btn-group-sm d-flex d-sm-inline-flex">
                <a class="btn btn-brand btn-sm" href="{{ url_for('cliente.editar_cliente', id=c.id) if url_for else '#' }}" title="Editar">
                  <i class="fas fa-pen"></i>
                </a>
                <a class="btn btn-outline-light btn-sm" style="border-color:rgba(255,255,255,.25)"
                   href="{{ url_for('cliente.detalhar_cliente', id=c.id) if url_for else '#' }}" title="Detalhar">
                  <i class="fas fa-eye"></i>
                </a>
                <form method="POST" action="{{ url_for('cliente.excluir_cliente', id=c.id) if url_for else '#' }}"
                      onsubmit="return confirm('Confirma excluir {{ c.nome }}?');" class="d-inline">
                  <button class="btn btn-outline-light btn-sm" style="border-color:rgba(255,255,255,.25)" title="Excluir">
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="8" class="text-center text-muted py-4">Nenhum cliente encontrado.</td></tr>
        {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  {% if paginacao %}
  <div class="card-footer d-flex justify-content-between align-items-center">
    <span class="text-muted small">
      Página {{ paginacao.page }} de {{ paginacao.pages }} — {{ paginacao.total }} registros
    </span>
    <nav>
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item {% if not paginacao.has_prev %}disabled{% endif %}">
          <a class="page-link"
             href="{{ url_for('cliente.listar_clientes', pagina=paginacao.prev_num, q=request.args.get('q')) }}">«</a>
        </li>

        {# janela de páginas ao redor da atual (±2) #}
        {% set start = 1 if paginacao.page - 2 < 1 else paginacao.page - 2 %}
        {% set end = paginacao.pages if paginacao.page + 2 > paginacao.pages else paginacao.page + 2 %}
        {% for p in range(start, end + 1) %}
          <li class="page-item {% if p == paginacao.page %}active{% endif %}">
            <a class="page-link"
               href="{{ url_for('cliente.listar_clientes', pagina=p, q=request.args.get('q')) }}">{{ p }}</a>
          </li>
        {% endfor %}

        <li class="page-item {% if not paginacao.has_next %}disabled{% endif %}">
          <a class="page-link"
             href="{{ url_for('cliente.listar_clientes', pagina=paginacao.next_num, q=request.args.get('q')) }}">»</a>
        </li>
      </ul>
    </nav>
  </div>
  {% endif %}

</div>

{% endblock %}
