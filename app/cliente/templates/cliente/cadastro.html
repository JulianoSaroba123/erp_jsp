{% extends 'base.html' %}
{% block titulo %}{{ 'Editar Cliente' if cliente else 'Cadastro de Cliente' }} — JSP ERP{% endblock %}
{% block content %}

<style>
/* === Layout principal === */
.main-content {
  margin-left: 260px;           /* ocupa o espaço da sidebar */
  padding: 24px;
  width: calc(100% - 260px);    /* pega toda largura restante */
  max-width: 100%;              /* sem limite fixo */
  box-sizing: border-box;
}
.card-jsp {
  width: 100%;
  margin: 0 auto 1.5rem auto;
}

/* === Inputs e selects === */
.form-control, .form-select {
  background: rgba(255,255,255,.07);
  color: #eaf3ff;
  border-color: rgba(255,255,255,.15);
}
.form-control::placeholder { color:#9fb3d6; opacity:1; }
.form-control:focus, .form-select:focus {
  border-color: #0dcaf0;
  box-shadow: 0 0 0 .2rem rgba(13,202,240,.15);
}
.form-label { font-weight:600; color:#eaf3ff; }

/* === Cards === */
.card-jsp .card-header {
  font-weight:600;
  display:flex; align-items:center; gap:.5rem;
  background: linear-gradient(135deg, rgba(41,182,255,.18), rgba(86,212,255,.10));
  color:#eaf6ff;
}
.card-jsp .card-body { padding:1.25rem; }

/* Card mais compacto para Tipo de Pessoa */
.card-jsp.tipo-pessoa .card-body {
  display: flex;
  gap: 2rem;
  align-items: center;
  padding: 1rem 1.5rem;
}

/* === Botões === */
.actions { display:flex; justify-content:space-between; gap:1rem; margin-top:1rem; }

/* Mobile ajustes */
@media(max-width:768px){
  .main-content { margin-left:0; width:100%; padding:16px; }
  .actions { flex-direction:column-reverse; }
  .actions .btn { width:100%; }
}
</style>

<div class="page-title mb-3">
  <div class="ico"><i class="fas fa-user-plus"></i></div>
  <h3 class="m-0">{{ 'Editar Cliente' if cliente else 'Cadastro de Cliente' }}</h3>
</div>

<div class="card card-jsp">
  <div class="card-header d-flex flex-wrap gap-2 align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-2">
      <i class="fas fa-user-cog"></i>
      <strong>{{ 'Edição de Cliente' if cliente else 'Novo Cliente' }}</strong>
      {% if cliente %}
        <code class="d-none d-md-inline">{{ cliente.codigo or ('CLI%05d' % cliente.id) }}</code>
      {% endif %}
    </div>
    <a class="btn btn-outline-light btn-sm" href="{{ url_for('cliente.listar_clientes') }}">
      <i class="fas fa-arrow-left me-1"></i> Voltar
    </a>
  </div>

  <div class="card-body">
    <form method="POST">

      <!-- Tipo de Pessoa -->
      <div class="card card-jsp tipo-pessoa">
        <div class="card-header"><i class="fas fa-id-card me-2"></i>Tipo de Pessoa</div>
        <div class="card-body">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="tipo_pessoa" id="tipo_pf" value="PF"
              {{ 'checked' if not cliente or (cliente and cliente.cpf_cnpj and cliente.cpf_cnpj|length <= 14) else '' }}>
            <label class="form-check-label" for="tipo_pf"><i class="fas fa-user me-1"></i>Pessoa Física (CPF)</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="tipo_pessoa" id="tipo_pj" value="PJ"
              {{ 'checked' if cliente and cliente.cpf_cnpj and cliente.cpf_cnpj|length > 14 else '' }}>
            <label class="form-check-label" for="tipo_pj"><i class="fas fa-building me-1"></i>Pessoa Jurídica (CNPJ)</label>
          </div>
        </div>
      </div>

      <!-- Informações Principais -->
      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-info-circle me-2"></i>Informações Principais</div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-3 mb-3">
              <label for="cpf_cnpj" class="form-label" id="label_cpf_cnpj">CPF / CNPJ *</label>
              <input type="text" id="cpf_cnpj" name="cpf_cnpj" class="form-control" maxlength="18"
                     value="{{ cliente.cpf_cnpj if cliente else '' }}" required>
              <small class="text-muted" id="hint_cpf_cnpj">Digite apenas números</small>
            </div>
            <div class="col-md-9 mb-3">
              <label for="nome" class="form-label" id="label_nome">Nome / Razão Social *</label>
              <input type="text" id="nome" name="nome" class="form-control"
                     value="{{ cliente.nome if cliente else '' }}" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="apelido" class="form-label">Apelido / Nome Fantasia</label>
              <input type="text" id="apelido" name="apelido" class="form-control"
                     value="{{ cliente.apelido if cliente else '' }}">
            </div>
            <div class="col-md-3 mb-3">
              <label for="telefone" class="form-label">Telefone *</label>
              <input type="text" id="telefone" name="telefone" class="form-control"
                     value="{{ cliente.telefone if cliente else '' }}" required>
            </div>
            <div class="col-md-3 mb-3">
              <label for="email" class="form-label">E-mail</label>
              <input type="email" id="email" name="email" class="form-control"
                     value="{{ cliente.email if cliente else '' }}">
            </div>
          </div>
        </div>
      </div>

      <!-- Endereço -->
      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-map-marker-alt me-2"></i>Endereço</div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-3 mb-3">
              <label for="cep" class="form-label">CEP</label>
              <input type="text" id="cep" name="cep" class="form-control" maxlength="9"
                     value="{{ cliente.cep if cliente else '' }}">
            </div>
            <div class="col-md-6 mb-3">
              <label for="logradouro" class="form-label">Logradouro</label>
              <input type="text" id="logradouro" name="logradouro" class="form-control"
                     value="{{ cliente.logradouro if cliente else '' }}">
            </div>
            <div class="col-md-3 mb-3">
              <label for="numero" class="form-label">Número</label>
              <input type="text" id="numero" name="numero" class="form-control"
                     value="{{ cliente.numero if cliente else '' }}">
            </div>
          </div>
          <div class="row">
            <div class="col-md-4 mb-3">
              <label for="complemento" class="form-label">Complemento</label>
              <input type="text" id="complemento" name="complemento" class="form-control"
                     value="{{ cliente.complemento if cliente else '' }}">
            </div>
            <div class="col-md-4 mb-3">
              <label for="bairro" class="form-label">Bairro</label>
              <input type="text" id="bairro" name="bairro" class="form-control"
                     value="{{ cliente.bairro if cliente else '' }}">
            </div>
            <div class="col-md-4 mb-3">
              <label for="cidade" class="form-label">Cidade</label>
              <input type="text" id="cidade" name="cidade" class="form-control"
                     value="{{ cliente.cidade if cliente else '' }}">
            </div>
          </div>
          <div class="row">
            <div class="col-md-3 mb-3">
              <label for="uf" class="form-label">UF</label>
              <select id="uf" name="uf" class="form-select">
                <option value="">Selecione</option>
                {% for uf in ['AC','AL','AP','AM','BA','CE','DF','ES','GO','MA','MT','MS','MG','PA','PB','PR','PE','PI','RJ','RN','RS','RO','RR','SC','SP','SE','TO'] %}
                  <option value="{{ uf }}" {{ 'selected' if cliente and cliente.uf == uf else '' }}>{{ uf }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-3 mb-3">
              <label for="pais" class="form-label">País</label>
              <input type="text" id="pais" name="pais" class="form-control"
                     value="{{ cliente.pais if cliente else 'Brasil' }}">
            </div>
          </div>
        </div>
      </div>

      <!-- Informações Adicionais -->
      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-clipboard me-2"></i>Informações Adicionais</div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3" id="inscricao_estadual_group">
              <label for="inscricao_estadual" class="form-label">Inscrição Estadual</label>
              <input type="text" id="inscricao_estadual" name="inscricao_estadual" class="form-control"
                     value="{{ cliente.inscricao_estadual if cliente else '' }}">
            </div>
            <div class="col-md-6 mb-3" id="inscricao_municipal_group">
              <label for="inscricao_municipal" class="form-label">Inscrição Municipal</label>
              <input type="text" id="inscricao_municipal" name="inscricao_municipal" class="form-control"
                     value="{{ cliente.inscricao_municipal if cliente else '' }}">
            </div>
          </div>
          <div class="mb-3">
            <label for="observacoes" class="form-label">Observações</label>
            <textarea id="observacoes" name="observacoes" class="form-control" rows="3">{{ cliente.observacoes if cliente else '' }}</textarea>
          </div>
        </div>
      </div>

      <!-- Botões -->
      <div class="actions">
        <a href="{{ url_for('cliente.listar_clientes') }}" class="btn btn-outline-light">
          <i class="fas fa-arrow-left me-1"></i> Voltar
        </a>
        <button type="submit" class="btn btn-brand">
          <i class="fas fa-save me-1"></i>
          {{ 'Atualizar Cliente' if cliente else 'Salvar Cliente' }}
        </button>
      </div>
    </form>
  </div>
</div>

{% endblock %}
