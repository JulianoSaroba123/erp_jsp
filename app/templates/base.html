<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block titulo %}JSP ERP - Elétrica Industrial{% endblock %}</title>
  <link rel="icon" type="image/svg+xml"
        h    .card-jsp{
      background: var(--glass); border:1px solid var(--glass-bd);
      border-radius:16px; box-shadow: 0 18px 38px rgba(0,0,0,.32), inset 0 1px 0 rgba(255,255,255,.05);
      color:var(--jsp-text); width: 100%; margin: 0 auto; max-width: 1400px;
    }
    .card-jsp .card-header{
      background: linear-gradient(135deg, rgba(41,182,255,.18), rgba(86,212,255,.10));
      border-bottom:1px solid rgba(255,255,255,.12); padding: 1rem 1.5rem;
    }:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E⚡%3C/text%3E%3C/svg%3E">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

  <style>
    /* =========================
       THEME • Neo Robo (azul/ciano)
       ========================= */
    :root{
      --jsp-navy-950:#0b1526;
      --jsp-navy-900:#0f1f36;
      --jsp-navy-800:#132443;

      --jsp-blue:#29b6ff;
      --jsp-cyan:#56d4ff;

      --jsp-text:#eaf3ff;
      --jsp-muted:#9fb3d6;

      --bg-grad:
        radial-gradient(1200px 800px at 18% 12%, #24406e 0%, transparent 60%),
        radial-gradient(900px 900px at 82% 78%, #0e1f35 0%, transparent 55%),
        linear-gradient(180deg, var(--jsp-navy-800), var(--jsp-navy-950));

      --glass: rgba(13,24,44,.55);
      --glass-bd: rgba(255,255,255,.08);

      --btn-grad: linear-gradient(135deg, var(--jsp-blue), var(--jsp-cyan));
      --sidebar-grad: linear-gradient(180deg, rgba(9,20,38,.96) 0%, rgba(13,28,50,.96) 100%);
      --sidebar-rail: linear-gradient(180deg, rgba(86,212,255,.22) 0%, rgba(41,182,255,.15) 100%);
    }

    /* --- Layout base --- */
    html, body { height: 100%; }
    .app-shell {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100dvh; /* ocupa a altura da viewport */
    }

    html,body{height:100%}
    body{
      background: var(--bg-grad);
      color: var(--jsp-text);
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      position: relative;
      overflow-x: hidden;
    }

    /* ====== FUNDO: grade animada sutil ====== */
    body::before{
      content:"";
      position: fixed;
      inset:0;
      pointer-events:none;
      background-image:
        linear-gradient(rgba(86,212,255,.07) 1px, transparent 1px),
        linear-gradient(90deg, rgba(86,212,255,.07) 1px, transparent 1px);
      background-size: 48px 48px, 48px 48px;
      background-position: 0 0, 0 0;
      mix-blend-mode: screen;
      opacity:.35;
      animation: gridMove 30s linear infinite;
      z-index: 0;
    }
    @keyframes gridMove {
      0%   { background-position: 0 0, 0 0; }
      100% { background-position: 48px 48px, 48px 48px; }
    }

    a{ color: var(--jsp-cyan) } a:hover{ color:#a7eaff }

    /* ===== SIDEBAR (dark + neon) ===== */
    .sidebar{
      min-width:260px; max-width:260px; 
      position: sticky;
      top: 0;
      height: 100dvh;
      align-self: start;
      overflow-y: auto;
      z-index:100;
      background: var(--sidebar-grad);
      border-right: 1px solid rgba(255,255,255,.05);
      box-shadow: 2px 0 26px rgba(0,0,0,.35);
      display:flex; flex-direction:column; padding:22px 16px;
      border-top-right-radius:26px; border-bottom-right-radius:26px;
    }
    /* trilho neon na borda direita */
    .sidebar::after{
      content:""; position:absolute; top:0; right:0; bottom:0; width:2px;
      background: var(--sidebar-rail);
      box-shadow: 0 0 24px rgba(86,212,255,.45), 0 0 6px rgba(86,212,255,.6) inset;
      opacity:.9;
    }

    .sidebar .brand{
      display:flex; align-items:center; gap:10px; justify-content:center; margin-bottom:14px;
      color:#dff6ff; font-weight:900; letter-spacing:.6px;
      text-shadow: 0 0 10px rgba(86,212,255,.35);
    }
    .brand img{
      width:40px; height:40px; object-fit:contain;
      filter: drop-shadow(0 4px 12px rgba(41,182,255,.35));
    }

    .sidebar .nav-link{
      color:#cfe0ff; background:transparent; border-radius:12px;
      padding:10px 14px; margin:3px 6px; font-weight:700;
      display:flex; align-items:center; gap:10px; position:relative;
      transition: transform .05s ease, background .15s ease, color .15s ease, padding-left .15s ease, box-shadow .15s ease;
    }
    .sidebar .nav-link i{
      width:22px; text-align:center; color:#9bdfff; position:relative; isolation:isolate;
    }
    /* scanline nos ícones */
    .sidebar .nav-link i::after{
      content:""; position:absolute; inset:0; border-radius:4px;
      background: repeating-linear-gradient(180deg, rgba(255,255,255,0) 0 2px, rgba(255,255,255,.22) 2px 3px);
      mix-blend-mode: screen; opacity:0;
      transition: opacity .2s; pointer-events:none;
    }
    .sidebar .nav-link:hover i::after, .sidebar .nav-link.active i::after{
      opacity:.25; animation: scan 2.2s linear infinite;
    }
    @keyframes scan { to { transform: translateY(6px) } }

    .sidebar .nav-link:hover{
      background: rgba(86,212,255,.10); color:#eaf6ff; padding-left:18px;
      box-shadow: inset 0 0 0 1px rgba(86,212,255,.18), 0 6px 18px rgba(41,182,255,.12);
    }
    .sidebar .nav-link.active{
      background: rgba(86,212,255,.18);
      color:#ffffff;
      box-shadow: inset 0 0 0 1px rgba(86,212,255,.28), 0 8px 22px rgba(41,182,255,.18);
      transform: translateY(-1px);
    }

    /* ===== Subitens do Menu ===== */
    .sidebar .nav-item .nav {
      margin-top: 6px;
    }
    .sidebar .nav-item .nav .nav-link {
      font-size: 0.9em;
      font-weight: 500;
      padding: 6px 12px;
      margin: 1px 0;
      color: #b8d9ff;
      border-radius: 8px;
    }
    .sidebar .nav-item .nav .nav-link:hover {
      background: rgba(86,212,255,.08);
      color: #e0f0ff;
      padding-left: 16px;
    }
    .sidebar .nav-item .nav .nav-link.active {
      background: rgba(86,212,255,.12);
      color: #ffffff;
      font-weight: 600;
    }
    .sidebar .nav-item .nav .small.text-muted {
      font-size: 0.75em;
      color: #7bb3e8 !important;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    /* ===== Títulos das seções ===== */
    .sidebar-section-title {
      font-size: 0.8em;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 0 12px;
      opacity: 0.8;
    }

    /* ===== Menu Colapsável ===== */
    .sidebar .nav .nav-link{ 
      color:#cfe9ff; 
      padding:.5rem .75rem; 
      border-radius:.6rem;
    }
    .sidebar .nav .nav-link.active{
      background:rgba(41,182,255,.16);
      color:#eaf6ff;
      box-shadow:0 0 0 1px rgba(255,255,255,.12) inset;
    }
    .sidebar .nav .collapse .nav-link{ 
      font-size:.95rem; 
      opacity:.92;
    }
    .sidebar .nav .collapse .nav-link.active{ 
      opacity:1;
    }
    .sidebar .nav .has-children>.nav-link .fa-chevron-down,
    .sidebar .nav .nav-group>.nav-link .fa-chevron-down{ 
      transition:.2s transform;
    }
    .sidebar .nav .has-children>.nav-link[aria-expanded="true"] .fa-chevron-down,
    .sidebar .nav .nav-group>.nav-link[aria-expanded="true"] .fa-chevron-down{ 
      transform:rotate(180deg);
    }
    .sidebar .nav .nav-heading {
      font-size: 0.8em;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 0 12px;
      opacity: 0.8;
      color: #7bb3e8;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
    }

    /* ===== Toggle (hamburger) ===== */
    .menu-toggle{
      position: fixed; 
      top: 18px; 
      left: 20px; 
      z-index: 1100;
      width: 48px; 
      height: 48px; 
      border-radius: 50%;
      background: var(--btn-grad); 
      color: #051328; 
      border: none;
      box-shadow: 0 10px 24px rgba(41,182,255,.35), inset 0 -1px 0 rgba(255,255,255,.25);
      display: none; /* Oculto por padrão */
      transition: all 0.3s ease;
      cursor: pointer;
      /* Garantir que seja tocável em mobile */
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    /* Mobile: mostra o botão hamburger */
    @media (max-width: 992px) {
      .menu-toggle {
        display: flex !important;
        align-items: center;
        justify-content: center;
      }
    }
    
    /* Desktop: esconde o botão hamburger */
    @media (min-width: 992px) {
      .menu-toggle {
        display: none !important;
      }
    }
    
    .sidebar-hidden{ transform: translateX(-100%); }
    .sidebar-hidden + .menu-toggle{ left: 20px; }

    /* ===== Main / Glass cards ===== */
    .main-content{ margin-left:260px; padding:26px; position:relative; z-index:1; max-width: calc(100vw - 260px); overflow-x: auto; }
    @media (max-width: 992px){
      .main-content{ margin-left:0; padding:16px; max-width: 100vw; }
      .sidebar{ position:fixed; transform: translateX(-100%); }
      .app-shell { grid-template-columns: 1fr; }
    }
    
    /* Centralização e responsividade */
    .main-content > * {
      max-width: 100%;
    }

    .card-jsp{
      background: var(--glass); border:1px solid var(--glass-bd);
      border-radius:16px; box-shadow: 0 18px 38px rgba(0,0,0,.32), inset 0 1px 0 rgba(255,255,255,.05);
      color:var(--jsp-text); width: 100%; margin: 0 auto;
    }
    .card-jsp .card-header{
      background: linear-gradient(135deg, rgba(41,182,255,.18), rgba(86,212,255,.10));
      color:#eaf6ff; border-bottom:1px solid rgba(255,255,255,.08);
    }

    /* KPIs */
    .kpi{
      background: linear-gradient(135deg, rgba(41,182,255,.18), rgba(86,212,255,.10));
      border:1px solid rgba(86,212,255,.28); border-radius:14px;
      padding:16px 18px; color:#dff5ff; box-shadow: 0 8px 28px rgba(41,182,255,.15);
    }

    /* Tabela */
    .table-jsp{
      --bs-table-bg: rgba(15,31,54,.45);
      --bs-table-striped-bg: rgba(15,31,54,.64);
      color:#eaf3ff; border-radius:12px; overflow:hidden;
    }
    .table-jsp thead th{
      background: rgba(41,182,255,.16); color:#eaf6ff;
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .table-jsp tbody tr:hover{ background: rgba(255,255,255,.05) }

    /* Botões */
    .btn-brand{
      background: var(--btn-grad); color:#051328; font-weight:900; border:none;
      box-shadow:0 10px 24px rgba(41,182,255,.35), inset 0 -1px 0 rgba(255,255,255,.25);
    }
    .btn-brand:hover{ filter:brightness(1.06) }

    .logout-btn{
      background: linear-gradient(90deg, #e52d27 0%, #b31217 100%) !important; color:#fff !important; border:none !important;
      box-shadow:0 6px 18px #e52d2744 !important;
    }

    /* Título de página */
    .page-title{
      display:flex; align-items:center; gap:10px; margin-bottom:16px;
      color:#eaf3ff; text-shadow:0 1px 0 rgba(0,0,0,.4)
    }
    .page-title .ico{
      width:38px; height:38px; border-radius:10px;
      background: var(--btn-grad); color:#051328; display:grid; place-items:center;
      box-shadow: 0 8px 18px rgba(41,182,255,.25);
    }

    /* Mobile: dá espaço pro botão não ficar sobre o título */
    @media (max-width: 991.98px) {
      .page-title h1,
      .page-title h2,
      .page-title h3 {
        padding-left: 56px; /* ~ diâmetro do botão + folga */
      }
    }

    /* === RESPONSIVIDADE APRIMORADA PARA FORMULÁRIOS === */
    @media (max-width: 768px) {
      /* Formulários em mobile: uma coluna */
      .row .col-md-3,
      .row .col-md-4,
      .row .col-md-6,
      .row .col-md-8,
      .row .col-md-9 {
        flex: 0 0 100%;
        max-width: 100%;
      }
      
      /* Cards menores em mobile */
      .card-jsp {
        margin-bottom: 1rem;
        width: 100%;
      }
      
      .card-jsp .card-body {
        padding: 1rem;
      }
      
      /* Botões responsivos */
      .btn-group-mobile {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .btn-group-mobile .btn {
        width: 100%;
      }
      
      /* Tabelas responsivas */
      .table-responsive {
        font-size: 0.85rem;
        width: 100%;
        overflow-x: auto;
      }
      
      /* Inputs maiores para mobile */
      .form-control,
      .form-select {
        font-size: 16px; /* Evita zoom no iOS */
        padding: 0.75rem;
      }
      
      /* Page title menor em mobile */
      .page-title h3 {
        font-size: 1.25rem;
      }
      
      /* Margins menores */
      .main-content {
        padding: 1rem;
        max-width: 100vw;
      }
      
      /* Garantir centralização em mobile */
      .content-container {
        max-width: 100% !important;
        padding: 0 !important;
      }
    }
    
    @media (max-width: 576px) {
      /* Extra small devices */
      .card-jsp .card-header {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
      }
      
      .btn-sm {
        padding: 0.5rem 0.75rem;
        font-size: 0.8rem;
      }
      
      /* Oculta algumas colunas da tabela em mobile */
      .table th:nth-child(n+4),
      .table td:nth-child(n+4) {
        display: none;
      }
      
      /* Mostra apenas as 3 primeiras colunas */
      .table th:nth-child(-n+3),
      .table td:nth-child(-n+3) {
        display: table-cell;
      }
      
      /* Actions sempre visível */
      .table th:last-child,
      .table td:last-child {
        display: table-cell !important;
      }
    }
  </style>
</head>
<body class="app-shell">

{% if session.get('usuario') %}
  <!-- Toggle -->
  <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <img src="{{ url_for('static', filename='img/logo_atualizado.png') }}" alt="JSP">
      <span style="font-size:1.25rem;">JSP <strong>ERP</strong></span>
    </div>

      <!-- Operações Diárias -->
      <h6 class="sidebar-section-title mt-3 mb-2 text-info">Operações Diárias</h6>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link {% if request.endpoint and request.endpoint.startswith('cliente.') %}active{% endif %}" href="{{ url_for('cliente.listar_clientes') }}">
            <i class="fas fa-users"></i> Clientes
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.endpoint and request.endpoint.startswith('fornecedor.') %}active{% endif %}" href="{{ url_for('fornecedor.listar_fornecedores') }}">
            <i class="fas fa-truck"></i> Fornecedores
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.endpoint and request.endpoint.startswith('produto.') %}active{% endif %}" href="{{ url_for('produto.listar_produtos') }}">
            <i class="fas fa-boxes"></i> Produtos
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.endpoint and request.endpoint.startswith('servico.') %}active{% endif %}" href="{{ url_for('servico.listar_servicos') }}">
            <i class="fas fa-concierge-bell"></i> Serviços
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.endpoint and request.endpoint.startswith('orcamento.') %}active{% endif %}" href="{{ url_for('orcamento.listar_orcamentos') }}">
            <i class="fas fa-file-invoice-dollar"></i> Orçamentos
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.endpoint and request.endpoint.startswith('os.') %}active{% endif %}" href="{{ url_for('os.listar_os') }}">
            <i class="fas fa-tools"></i> Ordens de Serviço
          </a>
        </li>
        <!-- FINANCEIRO -->
        <li class="nav-group">
          <a class="nav-link d-flex align-items-center"
             data-bs-toggle="collapse" 
             href="#navFinanceiro" 
             role="button" 
             aria-expanded="{{ 'true' if request.path.startswith('/financeiro') else 'false' }}">
            <i class="fas fa-coins me-2"></i> Financeiro
            <i class="ms-auto fas fa-chevron-down small"></i>
          </a>
          <ul id="navFinanceiro" class="collapse {{ 'show' if request.path.startswith('/financeiro') else '' }}">
            <li><a class="nav-link" href="{{ url_for('financeiro.dashboard') }}">Dashboard</a></li>
            <li><a class="nav-link" href="{{ url_for('financeiro.listar') }}">Lançamentos</a></li>
            <li><a class="nav-link" href="{{ url_for('financeiro.novo') }}">Novo Lançamento</a></li>
          </ul>
        </li>
      </ul>

      <!-- Cadastros / Configurações -->
      <h6 class="sidebar-section-title mt-4 mb-2 text-info">Cadastros / Configurações</h6>
      <ul class="nav flex-column">
      <!-- CADASTROS / CONFIGURAÇÕES -->
      <li class="nav-heading">Cadastros / Configurações</li>
      <li class="nav-group">
        <a class="nav-link d-flex align-items-center"
           data-bs-toggle="collapse" 
           href="#navConfigs" 
           role="button" 
           aria-expanded="{{ 'true' if request.path.startswith('/config') else 'false' }}">
          <i class="fas fa-sliders-h me-2"></i> Configurações
          <i class="ms-auto fas fa-chevron-down small"></i>
        </a>
        <ul id="navConfigs" class="collapse {{ 'show' if request.path.startswith('/config') else '' }}">
          <li><a class="nav-link" href="{{ url_for('configuracoes_condicoes_pagamento.listar_condicoes_pagamento') }}">Contas</a></li>
          <li><a class="nav-link" href="{{ url_for('configuracoes_condicoes_pagamento.listar_condicoes_pagamento') }}">Categorias</a></li>
          <li><a class="nav-link" href="{{ url_for('configuracoes_condicoes_pagamento.listar_condicoes_pagamento') }}">Formas de Pagamento</a></li>
          <li><a class="nav-link" href="{{ url_for('configuracoes_condicoes_pagamento.listar_condicoes_pagamento') }}">Status</a></li>
          <li><a class="nav-link" href="{{ url_for('configuracoes_condicoes_pagamento.listar_condicoes_pagamento') }}">Tipos</a></li>
          <li><a class="nav-link" href="{{ url_for('configuracoes_condicoes_pagamento.listar_condicoes_pagamento') }}">Condições de Pagamento</a></li>
        </ul>
      </li>
      </ul>

      <!-- Relatórios -->
      <h6 class="sidebar-section-title mt-4 mb-2 text-info">Relatórios</h6>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="#"><i class="fas fa-chart-bar"></i> Relatórios</a>
        </li>
      </ul>

    <div class="mt-auto">
      <a class="btn w-100 logout-btn mt-2" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt me-1"></i> Sair</a>
    </div>
  </aside>
{% endif %}

<main class="main-content" {% if not session.get('usuario') %}style="margin-left:0"{% endif %}>
  {% block content %}{% endblock %}
</main>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/5.0.6/inputmask.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function toggleSidebar(){
    const sidebar = document.getElementById('sidebar');
    const btn = document.querySelector('.menu-toggle');
    
    if (!sidebar || !btn) {
      console.error('Sidebar ou botão não encontrado');
      return;
    }
    
    sidebar.classList.toggle('sidebar-hidden');
    
    // Ajustar posição do botão baseado no estado da sidebar
    if (sidebar.classList.contains('sidebar-hidden')) {
      btn.style.left = '20px';
    } else {
      btn.style.left = '20px'; // Sempre na mesma posição em mobile
    }
  }

  // Configuração inicial para mobile
  (function(){
    if (window.innerWidth <= 992) {
      const sidebar = document.getElementById('sidebar');
      const btn = document.querySelector('.menu-toggle');
      if (sidebar && btn && !sidebar.classList.contains('sidebar-hidden')){
        sidebar.classList.add('sidebar-hidden');
        btn.style.left = '20px';
      }
    }
  })();

  // Fecha sidebar automaticamente quando clicar em link no mobile
  document.addEventListener('DOMContentLoaded', function() {
    const sidebarLinks = document.querySelectorAll('.sidebar .nav-link');
    const sidebar = document.getElementById('sidebar');
    const btn = document.querySelector('.menu-toggle');
    
    // Verificar se os elementos existem
    if (!sidebar || !btn) {
      console.error('Elementos da sidebar não encontrados');
      return;
    }
    
    sidebarLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (window.innerWidth <= 992 && sidebar && !sidebar.classList.contains('sidebar-hidden')) {
          setTimeout(() => {
            sidebar.classList.add('sidebar-hidden');
            btn.style.left = '20px';
          }, 200);
        }
      });
    });

    // Fecha sidebar ao clicar fora dela no mobile
    document.addEventListener('click', function(e) {
      if (window.innerWidth <= 992) {
        const sidebar = document.getElementById('sidebar');
        const btn = document.querySelector('.menu-toggle');
        
        if (sidebar && btn && !sidebar.classList.contains('sidebar-hidden') && 
            !sidebar.contains(e.target) && !btn.contains(e.target)) {
          sidebar.classList.add('sidebar-hidden');
          btn.style.left = '20px';
        }
      }
    });

    // Debug: log do estado inicial
    console.log('Menu mobile inicializado');
    console.log('Sidebar:', !!sidebar);
    console.log('Botão:', !!btn);
    console.log('Largura da tela:', window.innerWidth);
  });
</script>

{% block scripts %}{% endblock %}
</body>
</html>
