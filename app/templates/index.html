{% extends 'base.html' %}
{% block titulo %}Dashboard — JSP ERP{% endblock %}
{% block content %}

<style>
  /* layout do topo e cards rápidos */
  .hero { text-align:center; margin-bottom: 18px; }
  .hero .title { font-weight:900; font-size: clamp(1.4rem, 3vw, 2.2rem); }
  .hero .subtitle { color: var(--jsp-muted); margin-top:-4px }

  .kpi-grid{ display:grid; gap:14px; grid-template-columns: repeat(12, 1fr); }
  .kpi-grid > .col{ grid-column: span 12; }
  @media (min-width:576px){ .kpi-grid > .col{ grid-column: span 6; } }
  @media (min-width:992px){ .kpi-grid > .col{ grid-column: span 4; } }

  .kpi h6{ margin:0; font-weight:700; letter-spacing:.2px; color:#d7f2ff }
  .kpi .value{ font-size: clamp(1.2rem, 3.2vw, 2rem); font-weight:900; line-height:1.1 }

  .quick-grid{ display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(260px,1fr)); }
  .quick .card-header{ font-weight:800; border-bottom:1px solid rgba(255,255,255,.08) }
  .quick .card-body p{ color:var(--jsp-muted); margin-bottom:12px }

  /* cartas de gráfico */
  .chart-card{ min-height:360px; }
  .chart-card .card-header{ font-weight:800 }
  .chart-wrap{ position:relative; height: 260px }

  /* FAB */
  .quick-fab{ position:fixed; right:24px; bottom:24px; display:flex; flex-direction:column; gap:10px; z-index:999 }
  .quick-fab .btn{ width:52px; height:52px; border-radius:50%; padding:0; display:grid; place-items:center }
</style>

<div class="container-fluid">

  <!-- Hero -->
  <div class="hero">
    <div class="title">Bem-vindo ao <strong>JSP ERP</strong></div>
    <div class="subtitle">Gestão Industrial com DNA de automação ⚡</div>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid mb-3">
    <div class="col">
      <div class="kpi">
        <h6>Saldo</h6>
        <div class="value">R$ {{ saldo_total|default('0,00') }}</div>
      </div>
    </div>
    <div class="col">
      <div class="kpi">
        <h6>Entradas</h6>
        <div class="value">R$ {{ entradas_total|default('0,00') }}</div>
      </div>
    </div>
    <div class="col">
      <div class="kpi">
        <h6>Despesas</h6>
        <div class="value">R$ {{ saidas_total|default('0,00') }}</div>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="row g-3 mb-3">
    <div class="col-12 col-lg-6">
      <div class="card card-jsp chart-card">
        <div class="card-header">Entradas x Saídas (Mensal)</div>
        <div class="card-body">
          <div class="chart-wrap"><canvas id="barEntradasSaidas"></canvas></div>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="card card-jsp chart-card">
        <div class="card-header">Despesas por Categoria</div>
        <div class="card-body">
          <div class="chart-wrap"><canvas id="pieDespesasCategoria"></canvas></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ações rápidas -->
  <div class="quick mb-4">
    <div class="quick-grid">
      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-file-invoice-dollar me-2"></i> Orçamentos</div>
        <div class="card-body">
          <p>Crie, acompanhe e aprove orçamentos para seus clientes.</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('orcamento.listar_orcamentos') }}" class="btn btn-brand"><i class="fas fa-list me-1"></i> Visualizar</a>
            <a href="{{ url_for('orcamento.novo_orcamento') if url_for else '#' }}" class="btn btn-amber"><i class="fas fa-plus me-1"></i> Novo</a>
          </div>
        </div>
      </div>

      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-users me-2"></i> Clientes</div>
        <div class="card-body">
          <p>Cadastre clientes e gerencie contatos/endereço.</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('cliente.listar_clientes') }}" class="btn btn-brand"><i class="fas fa-list me-1"></i> Visualizar</a>
            <a href="{{ url_for('cliente.novo_cliente') }}" class="btn btn-amber"><i class="fas fa-plus me-1"></i> Novo</a>
          </div>
        </div>
      </div>

      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-boxes me-2"></i> Produtos</div>
        <div class="card-body">
          <p>Catálogo com preços e estoque controlados.</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('produto.listar_produtos') }}" class="btn btn-brand"><i class="fas fa-list me-1"></i> Visualizar</a>
            <a href="{{ url_for('produto.novo_produto') }}" class="btn btn-amber"><i class="fas fa-plus me-1"></i> Novo</a>
          </div>
        </div>
      </div>

      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-concierge-bell me-2"></i> Serviços</div>
        <div class="card-body">
          <p>Portfólio de serviços e unidades de cobrança.</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('servico.listar_servicos') }}" class="btn btn-brand"><i class="fas fa-list me-1"></i> Visualizar</a>
            <a href="{{ url_for('servico.novo_servico') }}" class="btn btn-amber"><i class="fas fa-plus me-1"></i> Novo</a>
          </div>
        </div>
      </div>

      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-truck me-2"></i> Fornecedores</div>
        <div class="card-body">
          <p>Cadastro de fornecedores e parcerias estratégicas.</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('fornecedor.listar_fornecedores') }}" class="btn btn-brand"><i class="fas fa-list me-1"></i> Visualizar</a>
            <a href="{{ url_for('fornecedor.novo_fornecedor') }}" class="btn btn-amber"><i class="fas fa-plus me-1"></i> Novo</a>
          </div>
        </div>
      </div>

      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-tools me-2"></i> Ordens de Serviço</div>
        <div class="card-body">
          <p>Controle de OS, apontamento e faturamento.</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('os.listar_os') }}" class="btn btn-brand"><i class="fas fa-list me-1"></i> Visualizar</a>
            <a href="{{ url_for('os.nova_os') if url_for else '#' }}" class="btn btn-amber"><i class="fas fa-plus me-1"></i> Nova</a>
          </div>
        </div>
      </div>

      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-wallet me-2"></i> Financeiro</div>
        <div class="card-body">
          <p>Lançamentos, categorias, conciliação e relatórios.</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('orcamento.listar_orcamentos') }}" class="btn btn-brand"><i class="fas fa-wallet me-1"></i> Acessar</a>
          </div>
        </div>
      </div>

      <div class="card card-jsp">
        <div class="card-header"><i class="fas fa-cog me-2"></i> Configurações</div>
        <div class="card-body">
          <p>Preferências do sistema e parâmetros operacionais.</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('configuracoes_condicoes_pagamento.listar_condicoes_pagamento') }}" class="btn btn-brand">
              <i class="fas fa-sliders me-1"></i> Abrir
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FAB -->
  <div class="quick-fab">
    <a href="{{ url_for('cliente.novo_cliente') }}" class="btn btn-brand" title="Novo Cliente (Alt+C)"><i class="fas fa-user-plus"></i></a>
    <a href="{{ url_for('servico.novo_servico') }}" class="btn btn-amber" title="Novo Serviço (Alt+S)"><i class="fas fa-tools"></i></a>
  </div>

</div>

<!-- Charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Paleta alinhada ao tema
  const gridColor = 'rgba(255,255,255,0.15)';
  const tickColor = '#eaf3ff';
  const entradasColor = 'rgba(86,212,255,0.85)';   // ciano JSP
  const saidasColor   = 'rgba(231,76,60,0.85)';    // vermelho despesas

  // Entradas x Saídas
  new Chart(document.getElementById('barEntradasSaidas'), {
    type: 'bar',
    data: {
      labels: ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],
      datasets: [
        { label: 'Entradas',
          data: JSON.parse('{{ grafico_entradas|tojson|safe }}'),
          backgroundColor: entradasColor, borderRadius: 8, maxBarThickness: 28 },
        { label: 'Saídas',
          data: JSON.parse('{{ grafico_saidas|tojson|safe }}'),
          backgroundColor: saidasColor, borderRadius: 8, maxBarThickness: 28 }
      ]
    },
    options: {
      plugins:{
        legend:{ labels:{ color: tickColor, font:{ weight:'bold' } } },
        tooltip:{
          backgroundColor:'#0f1f36', titleColor:'#fff', bodyColor:'#fff', borderColor:'#fff', borderWidth:1,
          callbacks:{ label:(ctx)=>`${ctx.dataset.label}: R$ ${ctx.parsed.y?.toLocaleString('pt-BR',{minimumFractionDigits:2})}` }
        }
      },
      scales:{
        x:{ ticks:{ color:tickColor }, grid:{ display:false } },
        y:{ ticks:{ color:tickColor }, grid:{ color:gridColor } }
      },
      maintainAspectRatio:false
    }
  });

  // Pizza por categoria
  new Chart(document.getElementById('pieDespesasCategoria'), {
    type:'doughnut',
    data:{
      labels: JSON.parse('{{ categorias|tojson|safe }}'),
      datasets:[{
        data: JSON.parse('{{ valores_cat|tojson|safe }}'),
        backgroundColor: ['#56d4ff','#29b6ff','#ffb547','#ff9f1a','#2ecc71','#8e44ad','#36a2eb','#00b894','#e17055','#6c5ce7'],
        borderWidth:2, borderColor:'#181c2f'
      }]
    },
    options:{
      plugins:{
        legend:{ position:'bottom', labels:{ color:tickColor } },
        tooltip:{
          backgroundColor:'#0f1f36', titleColor:'#fff', bodyColor:'#fff', borderColor:'#fff', borderWidth:1,
          callbacks:{ label:(ctx)=>`${ctx.label}: R$ ${ctx.parsed?.toLocaleString('pt-BR',{minimumFractionDigits:2})}` }
        }
      },
      cutout:'64%', maintainAspectRatio:false
    }
  });
</script>
{% endblock %}
