<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">


<style>
/* ===== VARS / PALETA ===== */
:root{
  --navy:#1c3761;
  --navy-2:#264573;
  --cyan:#00e5ff;
  --cyan-2:#6feaff;
  --ink:#e7f4ff;
  --muted:#8fb0cf;
  --line:#3a5a85;
  --paper:#ffffff;
  --accent:#ff9800;
}

/* ===== PÁGINA ===== */
@page { 
  size: A4 portrait; 
  margin: 16mm 14mm 18mm 14mm; 
  @bottom-left { content: ""; }
  @bottom-center { content: ""; }
  @bottom-right { content: ""; }
  @top-left { content: ""; }
  @top-center { content: ""; }
  @top-right { content: ""; }
}
html,body{margin:0;padding:0;}
body{
  background:#fff!important;
  color:#0b1728;
  font: 10.5pt/1.45 "SFMono-Regular","Consolas","Menlo","Monaco","Courier New",monospace;
}

/* ===== HEADER ===== */
.header{
  display:flex; align-items:flex-start; justify-content:space-between;
  padding:10px 0 8px 0; position:relative;
}
.header::after{
  content:"";
  position:absolute; left:0; right:0; bottom:-6px; height:3px;
  background:
    linear-gradient(90deg,var(--cyan),var(--cyan) 40%,transparent 40%,transparent 60%,var(--cyan) 60%),
    linear-gradient(90deg,var(--navy),var(--navy));
}
.brand{display:flex; gap:12px; align-items:flex-start;}
.brand img{
  height:52px; 
  width:52px;
  border:2px solid var(--navy); 
  padding:4px; 
  border-radius:6px;
  background:#fff;
  object-fit:contain;
  display:block;
}
.brand-title{
  font-weight:700; color:var(--navy); letter-spacing:.4px; font-size:12pt;
}
.brand-sub{color:#324f78; font-size:9.5pt;}
.brand-title .solar{color:var(--accent);}

.header-right{
  text-align:right; min-width:240px; color:#243f63; font-size:9.5pt;
}

/* ===== CAPA/TÍTULO ===== */
.title{
  margin:10px 0 10px 0; position:relative; padding:8px 10px;
  color:var(--ink);
  border:1.5px solid var(--line);
  background:linear-gradient(135deg,var(--navy),var(--navy-2));
  text-transform:uppercase; letter-spacing:.6px; font-weight:800;
}
.title .code{
  display:inline-block; padding:2px 8px; margin-left:8px;
  background:rgba(0,229,255,.1); border:1px solid var(--cyan);
  color:var(--cyan); border-radius:4px;
}
.title .date{ float:right; color:var(--cyan-2); font-weight:700; }

/* ===== SEÇÕES ===== */
h2{
  margin:12px 0 6px 0; color:var(--navy); text-transform:uppercase;
  letter-spacing:.4px; font-size:11pt;
}
.section{
  position:relative; padding-top:6px; page-break-inside:avoid;
}
.section .tag{
  position:absolute; top:-8px; right:0; font-size:8.5pt; color:#4c6a93;
}

/* ===== QUADROS / TABELAS ===== */
.box{
  border:1px solid var(--line);
  border-radius:6px;
  padding:6px;
  background:
    linear-gradient(transparent 23px, rgba(28,55,97,.05) 24px) repeat-y;
  background-size:100% 24px;
}
table{ width:100%; border-collapse:collapse; background:var(--paper); }
th,td{ border:1px solid var(--line); padding:4px 6px; vertical-align:top; }
th{
  background:linear-gradient(180deg,#264573,#1c3761);
  color:var(--ink); letter-spacing:.3px; text-align:left;
}
td{ color:#0b1728; }
tr:nth-child(even) td{ background:#f5f9ff; }

/* Células numéricas */
.t-right{text-align:right;}
.nowrap{white-space:nowrap;}

/* Células com texto longo */
.wrap-text{
  word-wrap:break-word; 
  white-space:normal; 
  max-width:300px;
}

/* ===== BADGES / DECOS ===== */
.chip{
  display:inline-block; padding:2px 8px; border-radius:999px;
  border:1px solid var(--line); color:#1e3c64; font-weight:700;
  background:#e9f4ff;
}

/* ===== ASSINATURAS ===== */
.sign{width:100%; border:none; margin-top:28px;}
.sign td{border:none; text-align:center; padding-top:18px; font-size:11pt;}
.sign .lane{height:24px; border-bottom:1px dashed #4a6b97;}

/* ===== LAYOUT FINANCEIRO ===== */
.finance-header {
  width: 25%;
}
.finance-box {
  margin-bottom: 12px;
}
.finance-table {
  max-width: 300px;
}

/* ===== RESPONSIVO IMPRESSÃO ===== */
.table-responsive table{ table-layout:fixed; }
.table-responsive th,.table-responsive td{ word-wrap:break-word; white-space:normal; }

@media print{
  .title, th{ -webkit-print-color-adjust:exact; print-color-adjust:exact; }
}
</style>
</head>
<body>

<!-- ===== HEADER ===== -->
<div class="header">
  <div class="brand">
    <img src="{{ url_for('static', filename='img/logo_atualizado.png', _external=True) }}" alt="JSP" />
    <div>
      <div class="brand-title">JSP ELÉTRICA INDUSTRIAL &nbsp;&amp;&nbsp; <span class="solar">SOLAR</span></div>
      <div class="brand-sub">
        CNPJ 41.280.764/0001-65<br>
        Rua Indalécio Costa, 890 – Barra Funda – Tietê/SP – CEP 18532-122
      </div>
    </div>
  </div>
  <div class="header-right">
    <strong>(15) 99670-2036 • (15) 99802-5861</strong><br>
    atendimento@eletricasaroba.com<br>
    www.eletricasaroba.com.br<br>
    Resp.: <strong>Juliano Saroba Pereira</strong>
  </div>
</div>


<!-- ===== TÍTULO ===== -->
<div class="title">
  RELATÓRIO DE ORDEM DE SERVIÇO
  <span class="code">OS: {{ os.codigo }}</span>
  <span class="date">{% if os.data_emissao %}{{ os.data_emissao.strftime('%d/%m/%Y') }}{% else %}-{% endif %}</span>
</div>

<!-- ===== CLIENTE ===== -->
<div class="section">
  <h2>[01] DADOS DO CLIENTE</h2>
  <div class="box">
    <table>
      <tr><th class="nowrap">NOME</th><td>{{ os.cliente.nome }}</td></tr>
      <tr><th>CPF/CNPJ</th><td>{{ os.cliente.cpf_cnpj }}</td></tr>
      <tr><th>TELEFONE</th><td>{{ os.cliente.telefone }}</td></tr>
      <tr><th>E-MAIL</th><td>{{ os.cliente.email }}</td></tr>
      <tr><th>ENDEREÇO</th><td class="wrap-text">{{ os.cliente.endereco }}</td></tr>
    </table>
  </div>
</div>

<!-- ===== SERVIÇOS ===== -->
{% if servicos_realizados and servicos_realizados|length > 0 %}
<div class="section">
  <h2>[02] SERVIÇOS EXECUTADOS</h2>
  <div class="table-responsive box">
    <table>
      <thead>
        <tr>
          <th>SERVIÇO</th>
          <th class="t-right nowrap">HORAS</th>
          <th class="t-right nowrap">VL./H</th>
          <th class="t-right nowrap">TOTAL</th>
        </tr>
      </thead>
      <tbody>
        {% for s in servicos_realizados %}
        <tr>
          <td>{{ s.nome }}</td>
          <td class="t-right">{{ '%.2f'|format(s.qtd_horas|float) }}</td>
          <td class="t-right">R$ {{ '%.2f'|format(s.valor|float) }}</td>
          <td class="t-right">R$ {{ '%.2f'|format(s.valor_total|float) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

<!-- ===== PRODUTOS ===== -->
{% if produtos_utilizados and produtos_utilizados|length > 0 %}
<div class="section">
  <h2>[03] PRODUTOS UTILIZADOS</h2>
  <div class="table-responsive box">
    <table>
      <thead>
        <tr>
          <th>PRODUTO</th>
          <th class="t-right nowrap">QTD</th>
          <th class="t-right nowrap">VL. UNIT.</th>
          <th class="t-right nowrap">TOTAL</th>
        </tr>
      </thead>
      <tbody>
        {% for p in produtos_utilizados %}
        <tr>
          <td>{{ p.nome }}</td>
          <td class="t-right">{{ p.qtd }}</td>
          <td class="t-right">R$ {{ '%.2f'|format(p.valor|float) }}</td>
          <td class="t-right">R$ {{ '%.2f'|format((p.qtd|float)*(p.valor|float)) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

<!-- ===== EQUIPAMENTO ===== -->
<div class="section">
  <h2>[04] EQUIPAMENTO</h2>
  <div class="box">
    <table>
      <tr>
        <th>EQUIPAMENTO</th><th>MARCA</th><th>MODELO</th><th>Nº SÉRIE</th>
      </tr>
      <tr>
        <td>{{ os.equipamento_nome }}</td>
        <td>{{ os.equipamento_marca }}</td>
        <td>{{ os.equipamento_modelo }}</td>
        <td>{{ os.equipamento_numero_serie }}</td>
      </tr>
      <tr>
        <th>ACESSÓRIOS</th>
        <td colspan="3">{{ os.equipamento_acessorios }}</td>
      </tr>
    </table>
  </div>
</div>

<!-- ===== TÉCNICO / DESCRIÇÕES ===== -->
<div class="section">
  <h2>[05] TÉCNICO & DIAGNÓSTICO</h2>
  <div class="box">
    <p><span class="chip">TÉCNICO</span> {{ os.tecnico_responsavel or '—' }}</p>
    <div class="description-block">
      <span class="chip">PROBLEMA</span>
      <div class="description-text">{{ os.problema_descrito or '-' }}</div>
    </div>
    <div class="description-block">
      <span class="chip">SERVIÇO</span>
      <div class="description-text">{{ os.descricao_servico_realizado or '-' }}</div>
    </div>
  </div>
</div>

<!-- ===== FINANCEIRO ===== -->
<div class="section">
  <h2>[06] RESUMO FINANCEIRO</h2>
  <div class="box finance-box">
    <table class="finance-table">
      <tr><th class="finance-header">TOTAL SERVIÇOS</th><td class="t-right">R$ {{ '%.2f'|format(total_servicos|default(0)|float) }}</td></tr>
      <tr><th class="finance-header">TOTAL PRODUTOS</th><td class="t-right">R$ {{ '%.2f'|format(total_produtos|default(0)|float) }}</td></tr>
      {% if os.valor_deslocamento %}
      <tr><th class="finance-header">DESLOCAMENTO</th><td class="t-right">R$ {{ '%.2f'|format(os.valor_deslocamento|float) }}</td></tr>
      {% endif %}
      <tr>
        <th class="finance-header">VALOR TOTAL</th>
        <td class="t-right">R$ {{ '%.2f'|format(valor_total|default(0)|float) }}</td>
      </tr>
    </table>
  </div>
  
  <div class="box">
    <table>
      <tr><th colspan="2">DADOS PARA TRANSFERÊNCIA</th></tr>
      <tr><td>INSTITUIÇÃO</td><td>403 – CORA SCFI</td></tr>
      <tr><td>AGÊNCIA</td><td>0001</td></tr>
      <tr><td>CONTA</td><td>4633457-0</td></tr>
      <tr><td>TITULAR</td><td>Saroba Solar</td></tr>
      <tr><td>CNPJ</td><td>41.280.764/0001-65</td></tr>
      <tr><td>PIX</td><td>41.280.764/0001-65</td></tr>
    </table>
  </div>
</div>

<!-- ===== PARCELAS ===== -->
{% if os and os.condicoes_pagamento == 'Parcelado' and parcelas_salvas %}
<div class="section">
  <h2>[07] PARCELAS DO PAGAMENTO</h2>
  <div class="box">
    <table>
      <tr><th>VENCIMENTO</th><th class="t-right">VALOR (R$)</th><th>SITUAÇÃO</th></tr>
      {% for par in parcelas_salvas %}
      <tr>
        <td>
          {%- set venc = par.vencimento or par.data or '' -%}
          {%- if venc -%}
            {%- if venc.__class__.__name__ == 'date' -%}
              {{ venc.strftime('%d/%m/%Y') }}
            {%- elif '-' in venc -%}
              {{ venc.split('T')[0].split(' ')[0].split('-')|reverse|join('/') }}
            {%- else -%}
              {{ venc }}
            {%- endif -%}
          {%- else -%} — {%- endif -%}
        </td>
        <td class="t-right">R$ {{ '%.2f'|format(par.valor|float) }}</td>
        <td>{{ par.situacao or 'Em aberto' }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
{% endif %}

<!-- ===== ASSINATURAS ===== -->
<table class="sign">
  <tr>
    <td>
      <div class="lane"></div>
      Assinatura do Técnico
    </td>
    <td>
      <div class="lane"></div>
      Assinatura do Cliente
    </td>
  </tr>
</table>

</body>
</html>
